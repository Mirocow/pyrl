┌─────────────────────────────────────────────────────────────────────────────┐
│                          PYRL ECOSYSTEM ARCHITECTURE                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              CORE LAYER                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐      │
│  │   PyrlLexer      │    │   PyrlParser     │    │ PyrlTransformer  │      │
│  ├──────────────────┤    ├──────────────────┤    ├──────────────────┤      │
│  │ + tokenize()     │───▶│ + parse()        │───▶│ + transform()    │      │
│  │ + get_tokens()   │    │ + build_ast()    │    │ + visit_*()      │      │
│  │ - sigil_map      │    │ - grammar        │    │ - memory_ref     │      │
│  └──────────────────┘    └──────────────────┘    └──────────────────┘      │
│           │                       │                       │                 │
│           └───────────────────────┴───────────────────────┘                 │
│                                   │                                         │
│                                   ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                            PyrlVM                                    │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │ Attributes:                                                          │  │
│  │   - memory: MemoryStore         # Управление памятью                 │  │
│  │   - parser: PyrlParser          # Парсер Lark                        │  │
│  │   - test_results: List[dict]    # Результаты тестов                  │  │
│  │   - call_stack: CallStack       # Стек вызовов                       │  │
│  │   - scope_chain: ScopeChain     # Цепочка областей видимости         │  │
│  │                                                                      │  │
│  │ Methods:                                                             │  │
│  │   + execute(code: str) -> Any                                       │  │
│  │   + register_function(name: str, func: Callable)                    │  │
│  │   + get_variable(var_name: str) -> Any                              │  │
│  │   + set_variable(var_name: str, value: Any)                         │  │
│  │   + run_tests(code: str) -> List[dict]                              │  │
│  │   + push_scope() -> None                                            │  │
│  │   + pop_scope() -> None                                             │  │
│  │   - _resolve_scope(var_name: str) -> Scope                          │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            DATA STRUCTURES                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐      │
│  │   MemoryStore    │    │    CallStack     │    │   ScopeChain     │      │
│  ├──────────────────┤    ├──────────────────┤    ├──────────────────┤      │
│  │ + scalars: Dict  │    │ + frames: List   │    │ + scopes: List   │      │
│  │ + arrays: Dict   │    │ + push()         │    │ + push()         │      │
│  │ + hashes: Dict   │    │ + pop()          │    │ + pop()          │      │
│  │ + functions: Dict│    │ + peek()         │    │ + lookup()       │      │
│  │ + get()          │    │ + get_local()    │    │ + set_local()    │      │
│  │ + set()          │    └──────────────────┘    └──────────────────┘      │
│  └──────────────────┘                                                       │
│                                                                             │
│  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐      │
│  │   PyrlScalar     │    │   PyrlArray      │    │   PyrlHash       │      │
│  ├──────────────────┤    ├──────────────────┤    ├──────────────────┤      │
│  │ + value: Any     │    │ + items: List    │    │ + items: Dict    │      │
│  │ + type: str      │    │ + push()         │    │ + get()          │      │
│  │ + __str__()      │    │ + pop()          │    │ + set()          │      │
│  └──────────────────┘    │ + get()          │    │ + keys()         │      │
│                          │ + slice()        │    │ + values()       │      │
│                          └──────────────────┘    └──────────────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           HTTP API LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        PyrlHTTPServer                                 │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │ Routes:                                                              │  │
│  │   POST /execute          # Выполнить код Pyrl                        │  │
│  │   POST /run_tests        # Запустить тесты                           │  │
│  │   POST /generate_vue     # Сгенерировать Vue компонент               │  │
│  │   GET  /memory           # Получить состояние памяти                 │  │
│  │   POST /reset            # Сбросить VM                               │  │
│  │                                                                      │  │
│  │ Methods:                                                             │  │
│  │   + setup_routes()                                                   │  │
│  │   + run(host: str, port: int)                                        │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          GENERATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                       PyrlVueGenerator                                │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │ Methods:                                                             │  │
│  │   + generate_component(name: str, props: Dict) -> str               │  │
│  │   + generate_template(name: str, props: Dict) -> str                │  │
│  │   + generate_script(props: Dict, methods: Dict) -> str              │  │
│  │   + generate_style(name: str, css: Dict) -> str                     │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                     PyrlDataGenerator                                 │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │ Methods:                                                             │  │
│  │   + generate_dataset(count: int) -> List[dict]                      │  │
│  │   + generate_code_sample(type: str) -> str                          │  │
│  │   + export_jsonl(dataset: List, path: str) -> None                  │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          TESTING LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        PyrlTestRunner                                 │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │ Attributes:                                                          │  │
│  │   - results: List[TestResult]                                        │  │
│  │   - passed: int                                                      │  │
│  │   - failed: int                                                      │  │
│  │                                                                      │  │
│  │ Methods:                                                             │  │
│  │   + run_test_block(block: List[Statement]) -> List[TestResult]      │  │
│  │   + assert_equal(left: Any, right: Any) -> bool                     │  │
│  │   + assert_not_equal(left: Any, right: Any) -> bool                 │  │
│  │   + assert_truthy(expr: Any) -> bool                                │  │
│  │   + report() -> str                                                  │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│  ┌──────────────────┐                                                       │
│  │   TestResult     │                                                       │
│  ├──────────────────┤                                                       │
│  │ + name: str      │                                                       │
│  │ + success: bool  │                                                       │
│  │ + message: str   │                                                       │
│  │ + line: int      │                                                       │
│  │ + expected: Any  │                                                       │
│  │ + actual: Any    │                                                       │
│  └──────────────────┘                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘