# ============================================================
# Pyrl Grammar Server
# Automatically reads and displays grammar from lark_parser.py
# ============================================================

print("=" * 70)
print("  PYRL LANGUAGE GRAMMAR SERVER")
print("=" * 70)
print("")

# Read grammar from lark_parser.py
$grammar_path = "src/core/lark_parser.py"
print("Reading grammar from: " + $grammar_path)
print("")

# Read the file
$grammar_content = read_file($grammar_path)

# Extract GRAMMAR section
$start_marker = 'GRAMMAR = r"""'
$end_marker = '"""'

$start_idx = find($grammar_content, $start_marker)
if $start_idx >= 0:
    $start_idx = $start_idx + len($start_marker)
    $end_idx = find($grammar_content, $end_marker, $start_idx)
    if $end_idx >= 0:
        $grammar_text = substr($grammar_content, $start_idx, $end_idx - $start_idx)

        print("=" * 70)
        print("  GRAMMAR DEFINITION")
        print("=" * 70)
        print($grammar_text)
    else:
        print("ERROR: Could not find end of grammar")
else:
    print("ERROR: Could not find GRAMMAR definition")

print("")
print("=" * 70)
print("  CONSTRUCTS SUMMARY")
print("=" * 70)
print("")

# Display all possible constructs
print("VARIABLES (Sigils):")
print("  $name   - Scalar variable (single value)")
print("  @name   - Array variable (list)")
print("  %name   - Hash variable (dictionary)")
print("  &name   - Function variable (reference)")
print("")

print("LITERALS:")
print("  123           - Integer")
print("  3.14          - Float")
print("  \"string\"     - Double-quoted string")
print("  'string'      - Single-quoted string")
print("  \"\"\"multi\"\"\"  - Triple-quoted string")
print("  True / False  - Boolean")
print("  None / null   - None value")
print("  [1, 2, 3]     - Array literal")
print("  {key: value}  - Hash literal")
print("  r\"pattern\"    - Regex literal")
print("  m/pattern/    - Perl regex match")
print("  s/old/new/    - Perl regex substitute")
print("")

print("OPERATORS:")
print("  Arithmetic: + - * / // % ** ^")
print("  Comparison: == != < > <= >= =~ !~")
print("  Logical:    and or not !")
print("  Membership: in not in")
print("")

print("STATEMENTS (Single-line):")
print("  $x = 10                    - Assignment")
print("  @arr[0] = 5                - Array index assignment")
print("  %hash[\"key\"] = \"value\"     - Hash key assignment")
print("  print(\"Hello\")             - Print statement")
print("  return $value              - Return statement")
print("  assert $x == 10            - Assert statement")
print("  $x                         - Expression statement")
print("")

print("STATEMENTS (Multi-line/Block):")
print("")
print("  # Function definition (Python-style):")
print("  def name($arg1, $arg2):")
print("      statement1")
print("      statement2")
print("")
print("  # Anonymous function (block syntax):")
print("  &name($arg) = {")
print("      statement1")
print("      statement2")
print("  }")
print("")
print("  # Anonymous function (indented):")
print("  &name($arg):")
print("      statement1")
print("      statement2")
print("")

print("CONTROL FLOW (Indented):")
print("")
print("  # If/elif/else:")
print("  if condition:")
print("      statement")
print("  elif condition:")
print("      statement")
print("  else:")
print("      statement")
print("")
print("  # For loop:")
print("  for $item in iterable:")
print("      statement")
print("")
print("  # While loop:")
print("  while condition:")
print("      statement")
print("")

print("CONTROL FLOW (Block syntax):")
print("")
print("  # If/else:")
print("  if condition { statement1; statement2 }")
print("  if condition {")
print("      statement1")
print("  } else {")
print("      statement2")
print("  }")
print("")
print("  # For loop:")
print("  for $item in iterable { statement }")
print("")
print("  # While loop:")
print("  while condition { statement }")
print("")

print("CLASSES (Block syntax):")
print("")
print("  class ClassName {")
print("      prop property_name")
print("      prop property_with_default = value")
print("      init($arg) = { statement }")
print("      method name($arg) = { statement }")
print("  }")
print("")
print("  class Child extends Parent {")
print("      init($arg) = { statement }")
print("      method name($arg) = { statement }")
print("  }")
print("")

print("CLASSES (Indented syntax):")
print("")
print("  class ClassName:")
print("      prop name")
print("      def __init__($self, $arg):")
print("          statement")
print("      def method($self, $arg):")
print("          statement")
print("")

print("TEST BLOCKS:")
print("")
print("  test \"Test name\":")
print("      assert condition")
print("      statement")
print("")

print("ACCESS EXPRESSIONS:")
print("  $var           - Variable access")
print("  @arr[0]        - Array index access")
print("  %hash[\"key\"]   - Hash key access")
print("  %hash{key}     - Perl-style hash access")
print("  $obj.attr      - Attribute access")
print("  $obj.method()  - Method call")
print("  func()         - Function call")
print("  func($a, $b)   - Function with args")
print("")

print("SPECIAL FEATURES:")
print("  @arr[len(@arr)] = value  - Append to array")
print("  $result = { block; expr } - Block expression")
print("")

print("=" * 70)
print("  SERVER INFO")
print("=" * 70)
print("")
print("Grammar file: " + $grammar_path)
print("Last updated: " + file_modified($grammar_path))
print("")
print("=" * 70)
print("  Server running. Press Ctrl+C to stop.")
print("=" * 70)
