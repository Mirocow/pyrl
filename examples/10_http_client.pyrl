# HTTP Client Example
# Demonstrates making HTTP requests in Pyrl

# Note: This example shows the intended API for HTTP operations
# Actual implementation depends on the runtime environment

# ===========================================
# HTTP GET REQUEST
# ===========================================

# Simple GET request
def http_get($url):
    print("GET " + $url)
    return {
        status: 200,
        body: '{"message": "Success"}'
    }

# GET with headers
def http_get_with_headers($url, %headers):
    print("GET " + $url)
    print("Headers: " + str(%headers))
    return {
        status: 200,
        body: '{"data": "response"}'
    }

# ===========================================
# HTTP POST REQUEST
# ===========================================

# Simple POST request
def http_post($url, $body):
    print("POST " + $url)
    print("Body: " + $body)
    return {
        status: 201,
        body: '{"id": 1, "created": true}'
    }

# POST with JSON
def http_post_json($url, %data):
    $json_body = str(%data)
    print("POST " + $url)
    print("JSON: " + $json_body)
    return {
        status: 201,
        body: '{"success": true}'
    }

# ===========================================
# WEBHOOK HANDLER SIMULATION
# ===========================================

def handle_webhook($event_type, %payload):
    print("Received webhook: " + $event_type)
    
    if $event_type == "user.created":
        return handle_user_created(%payload)
    if $event_type == "user.deleted":
        return handle_user_deleted(%payload)
    if $event_type == "order.placed":
        return handle_order_placed(%payload)
    return {status: 400, message: "Unknown event type"}

def handle_user_created(%data):
    print("Creating user: " + %data["name"])
    return {status: 200, message: "User created"}

def handle_user_deleted(%data):
    print("Deleting user: " + str(%data["id"]))
    return {status: 200, message: "User deleted"}

def handle_order_placed(%data):
    print("Processing order: " + str(%data["order_id"]))
    return {status: 200, message: "Order processed"}

# ===========================================
# API CLIENT (using functions)
# ===========================================

def create_client($base_url):
    return {
        base_url: $base_url,
        headers: {"Content-Type": "application/json"}
    }

def client_get(%client, $endpoint):
    $url = %client["base_url"] + $endpoint
    return http_get_with_headers($url, %client["headers"])

def client_post(%client, $endpoint, %data):
    $url = %client["base_url"] + $endpoint
    return http_post_json($url, %data)

def set_client_header(%client, $key, $value):
    %client["headers"][$key] = $value
    return %client

# Usage example
print("=== API Client Example ===")
$client = create_client("https://api.example.com")
$client = set_client_header($client, "Authorization", "Bearer token123")

$get_response = client_get($client, "/users")
print("GET Response: " + str($get_response))

%new_user = {name: "Alice", email: "alice@example.com"}
$post_response = client_post($client, "/users", %new_user)
print("POST Response: " + str($post_response))

print("\n=== Webhook Handler ===")
handle_webhook("user.created", {name: "Charlie", email: "charlie@example.com"})
handle_webhook("order.placed", {order_id: 12345, total: 99.99})
